---
layout: post
title: Mask Detector using TensorFlow Lite
author: ndaru
categories: ["face-mask", "macbook", "tensorflow", "machine-learning", "raspberry-pi"]
image: https://cdn-images-1.medium.com/max/1024/0*bGD2Rzp4-Qqax5_M
---
<p>It can use Raspberry Pi or Macbook Pro and send into slack, even use 4 USD webcam</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/0*bGD2Rzp4-Qqax5_M" /><figcaption>Photo by <a href="https://unsplash.com/@adamsky1973?utm_source=medium&amp;utm_medium=referral">Adam Nieścioruk</a> on <a href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral">Unsplash</a></figcaption></figure><p>Since some people don’t have sense of concern to use facemask on public area. Our office have regulation to assign some people to be watcher and take a record of image people which stubborn or forget. Furthermore it will took my time to watch surrounding and keep eye of my friend.</p><p>Because of that Isearch and found repository of <a href="https://github.com/AIZOOTech/FaceMaskDetection">Facemask detection</a> and give some improvement to save image when some frame was detected and send into slack.</p><p>In Indonesia, you can bought equipment here:</p><ul><li><a href="https://www.tokopedia.com/rajacell/kamera-usb-camera-8mp-untuk-raspberry-pi-3-model-b-kabel-tarik-retrack">Cheap webcam camera</a></li><li><a href="https://www.bukalapak.com/p/komputer/mini-pc/3dyw77y-jual-raspberry-pi-4-model-b-ram-8-gb-siap-pakai?product_sku=7399366470">Raspberry Pi 4 Complete</a>, it is already include case, memory card, and power cable, since it using dash cam, try to get usb cable. Or use some laptop /computer.</li><li><a href="https://www.tokopedia.com/rajacell/3pcs-black-aluminium-heatsink-pendingin-heat-sink-raspberry-pi-4-b-3b">Heatsink</a></li><li><a href="https://www.tokopedia.com/rajacell/wireless-mini-keyboard-rii-mini-i8-2-4g-touchpad-remote-support-raspi-hitam">Keyboard wireless</a></li></ul><p>This program is consist of several part:</p><p>Load Image Model</p><pre>sess, graph = load_tf_model(&#39;models/face_mask_detection.pb&#39;)</pre><p>Send image to tensorflow detection (Receive an image array and run inference). It have detection inference with several params:</p><ul><li>image: 3D numpy array of image</li><li>conf_thresh: the min threshold of classification probabity.</li><li>iou_thresh: the IOU threshold of NMS</li><li>target_shape: the model input size.</li><li>draw_result: whether to draw bounding box to the image.</li><li>show_result: whether to display the image.</li></ul><pre>y_bboxes_output, y_cls_output = tf_inference(sess, graph, image_exp)</pre><p>y_bboxes_output will return box detection coordinate</p><p>y_cls_output will return score of confidence image have using proper mask or not</p><ul><li>set label</li></ul><pre>id2class = {0: &#39;Mask&#39;, 1: &#39;NoMask&#39;}</pre><ul><li>write image</li></ul><pre>cv2.imwrite(filename_path, cv2.cvtColor(image, cv2.COLOR_RGB2BGR))</pre><ul><li>send to slack</li></ul><pre>requests.post(</pre><pre>&#39;https://slack.com/api/files.upload&#39;,</pre><pre>{</pre><pre>&#39;token&#39;: slack_token,</pre><pre>&#39;filename&#39;: file_name,</pre><pre>&#39;channels&#39;: slack_channel,</pre><pre>&#39;filetype&#39;: file_type,</pre><pre>&#39;initial_comment&#39;: text,</pre><pre>&#39;title&#39;: title</pre><pre>},</pre><pre>files = { &#39;file&#39;: file_bytes }).json()</pre><p>To running follow these step:</p><ul><li>git clone these repository</li><li>create virtual environment -&gt; virtual env facemask</li><li>activate virtual environemnt -&gt; source facemask/bin/activate</li><li>copy env -&gt; cp .env.staging .env</li><li>update env value with slack channel and slack token</li><li>install requirements depends on raspberry or mac -&gt; pip3 install -r requirements_raspberry.txt</li><li>run application -&gt; python3 tensorflow_infer.py — img-mode 0 — video-path 0</li></ul><p>Example image catch from running raspberry video webcam.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/640/1*BvwfD4M8xXXOU8D7M-Y5AA.jpeg" /></figure><figure><img alt="" src="https://cdn-images-1.medium.com/max/640/1*gwEfwyOI-Q_3ssPJz-eF7w.jpeg" /></figure><figure><img alt="" src="https://cdn-images-1.medium.com/max/640/1*9HoKRfZQxqAx2p128U1WeQ.jpeg" /><figcaption>People which using masked unproperly or not using mask. Capture with confidence score</figcaption></figure><p>See repository on <a href="https://github.com/kusumandaru/FaceMaskDetection">https://github.com/kusumandaru/FaceMaskDetection</a></p><img src="https://medium.com/_/stat?event=post.clientViewed&referrerSource=full_rss&postId=d0ebd2958220" width="1" height="1" alt="">